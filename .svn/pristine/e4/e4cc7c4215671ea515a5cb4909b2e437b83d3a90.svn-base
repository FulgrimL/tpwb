function goBackUndoPage(){if(mui.os.android){window.androidx.back()}else{if(mui.os.ios){iosGoBack()}}}function goBackPage(){var $curPage=$("#curPage");if($curPage.html()=="page1"){if($("#page1").attr("last-page")=="confirmPage"){changePage("page1","confirmPage","next")}else{console.log("这是第一个页面无法返回");window.history.back(-1)}}else{if($curPage.html()=="confirmPage"){var btnArray=["是","否"];mui.confirm("是否保存订单？","提示",btnArray,function(e){if(e.index==0){if(orderCode){var prdId=getUrlParam("prdId");GetData("orders/addorupdateorder",function(res){goBackUndoPage()},{"prdId":prdId,"orderCode":orderCode,"json":BASE64.encoder(JSON.stringify(submitJson))})}else{var prdId=getUrlParam("prdId");GetData("orders/addorupdateorder",function(res){history.go(-1)},{"prdId":prdId,"orderCode":"","json":BASE64.encoder(JSON.stringify(submitJson))})}}else{if(orderCode){goBackUndoPage()}else{history.go(-1)}}})}else{var c=$curPage.html();var backDiv=$("#"+c).attr("last-page");changePage(c,backDiv,"last")}}}function setScanValue(res,arr){var sex=$.others.IdCard(res.id,2);if(sex=="男"){sex="M"}else{if(sex=="女"){sex="F"}}var birthday=$.others.IdCard(res.id,1);$("#"+arr[0]).val(res.name);$("#"+arr[1]).val(res.id);$("#"+arr[2]).val(birthday);$("input:radio[name="+arr[3]+'][value="'+sex+'"]').prop("checked",true)}function setScanValueForIos(){var sex=$.others.IdCard(ios_res.id,2);if(sex=="男"){sex="M"}else{if(sex=="女"){sex="F"}}var birthday=$.others.IdCard(ios_res.id,1);$("#"+ios_arr[0]).val(ios_res.name);$("#"+ios_arr[1]).val(ios_res.id);$("#"+ios_arr[2]).val(birthday);$("input:radio[name="+ios_arr[3]+'][value="'+sex+'"]').prop("checked",true)}function getKeyNameValue(keyName){var arr=[];$.each(productJson,function(k,v){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.keyName==keyName){var type=v.type;if(type=="select"){var selValue=$("#"+keyName).attr("value");var selText=$("#"+keyName).text();arr.push(selText);arr.push(selValue)}else{if(type=="radio"){var val=$("input:radio[name="+keyName+"]:checked").val();arr.push(val)}else{if(type=="textarea"){var val=$("#"+keyName).text();arr.push(val)}else{var val=$("#"+keyName).val();arr.push(val)}}}}})})});return arr}function getKeyNameType(keyName){var type;$.each(productJson,function(k,v){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.keyName==keyName){type=v.type}})})});return type}function getKeyNameEvent(keyName){var evt;$.each(productJson,function(k,v){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.keyName==keyName){evt=v.event}})})});return evt}function getKeyNameModeltype(keyName){var mt;$.each(productJson,function(k,v){var modelColumn=v.modelColumn;var modelType=v.modelType;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.keyName==keyName){mt=modelType}})})});return mt}function setKeyNameValue(toKeyName,fromKeyName){var fromKeyNameValue=getKeyNameValue(fromKeyName);var toKeyNameType=getKeyNameType(toKeyName);if(toKeyNameType=="select"){$("#"+toKeyName).html(fromKeyNameValue[0]);$("#"+toKeyName).attr("value",fromKeyNameValue[1])}else{if(toKeyNameType=="radio"){$("input:radio[name="+toKeyName+'][value="'+fromKeyNameValue[0]+'"]').attr("checked",true)}else{if(toKeyNameType=="label"){$("#"+toKeyName).text(fromKeyNameValue[0])}else{$("#"+toKeyName).val(fromKeyNameValue[0])}}}}function getTextValue(obj,selectId,type){if(type=="select"){obj[selectId+"_TEXT"]=$("#"+selectId).html();obj[selectId]=$("#"+selectId).attr("value")}else{if(type=="radio"){obj[selectId+"_TEXT"]=$("input:radio[name="+selectId+"]:checked").siblings("label").text();obj[selectId]=$("input:radio[name="+selectId+"]:checked").val()}else{if(type=="textarea"){obj[selectId]=$("#"+selectId).text()}else{obj[selectId]=$("#"+selectId).val()}}}}function clearTextValue(selectId,type,value){if(type=="select"){$("#"+selectId).html("");for(var x in value){if(value[x].checked){$("#"+selectId).html(value[x].text);$("#"+selectId).attr("value",value[x].value)}}}else{if(type=="radio"){}else{$("#"+selectId).val("")}}}function setTextValue(obj,selectId,type){if(type=="select"){$("#"+selectId).html(obj[selectId+"_TEXT"]);$("#"+selectId).attr("value",obj[selectId])}else{if(type=="radio"){var radioVal=obj[selectId];$("input:radio[name="+selectId+'][value="'+radioVal+'"]').attr("checked",true)}else{$("#"+selectId).val(obj[selectId])}}}function clearAll(proJson){var nextPageNum=1;$.each(proJson,function(k,v){switch(v.modelType){case"home":if(v.xmlNode!="AGREEMENT"){$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})})}break;case"nextPage":nextPageNum++;$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)
})});$(".page"+nextPageNum+"HiddenInput").remove();break;case"listPage1":$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});$(".listPage1HiddenInput").remove();break;case"listPage2":$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});$(".listPage2HiddenInput").remove();break;case"listPage3":$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});$(".listPage3HiddenInput").remove();break;default:break}})}function showValue(text){if(text!=""&&text!=undefined&&text.substr(0,1)=="="){return""}else{return text}}function numericKeyup(obj){obj.value=obj.value.replace(/\D/g,"")}function idCardKeyup(obj,flagName){console.log(obj.value.length);var $this=$(obj);var thisVal=$this.val();var thisText=$this.siblings("label").text();var mt=flagName;if(thisVal.length==18){$this.parent().next(".tip").text("").hide();var eventStr=getKeyNameEvent($this.attr("id"));var arr1=eventStr.split(",");var fnName=arr1[0];if(fnName.indexOf("@")==0){fnName=fnName.substr(1);var arr2=arr1.splice(1,arr1.length);if(!$.valid.isIdCard2(thisVal)){$this.parent().next(".tip").text(thisText+"不合法").show();var mt=getKeyNameModeltype($this.attr("id"));eval(mt+"flag=false")}else{eval(mt+"flag=true");$this.parent().next(".tip").hide();eval(fnName+"(thisVal,arr2);")}}}else{eval(flagName+"flag=false;");$this.parent().next(".tip").text(thisText+"不合法").show()}}function idPhoneKeyup(obj,flagName){obj.value=obj.value.replace(/\D/g,"");var $this=$(obj);var thisVal=$this.val();var thisText=$this.siblings("label").text();var mt=flagName;if(thisVal.length==11){if(!$.valid.isPhoneNumber(thisVal)){$this.parent().next(".tip").text(thisText+"不合法").show();var mt=getKeyNameModeltype($this.attr("id"));eval(mt+"flag=false")}else{eval(mt+"flag=true");$this.parent().next(".tip").hide()}}else{eval(flagName+"flag=false;");$this.parent().next(".tip").text(thisText+"不合法").show()}}function createText($parentCotroller,textJson){var mt=getKeyNameModeltype(textJson.keyName);if(textJson.notNull=="Y"){var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/xing8.png"><label>'+textJson.keyText+"</label>"}else{var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/null.png"><label>'+textJson.keyText+"</label>"}if(textJson.readOnly==0||textJson.readOnly==undefined){textHtml+='<input type="text" placeholder="'+textJson.placeHolder+'" class="" id="'+textJson.keyName+'" value="'+showValue(textJson.value)+'">'}else{if(textJson.readOnly==1){textHtml+='<input type="text" placeholder="'+textJson.placeHolder+'" id="'+textJson.keyName+'" readonly="readonly" value="'+showValue(textJson.value)+'">'}}textHtml+='</div><div class="tip"></div>';$parentCotroller.append(textHtml);$("#"+textJson.keyName).blur(function(){if(textJson.notNull=="Y"){if($(this).val()==""){$("#"+textJson.keyName).parent().next(".tip").text(textJson.keyText+"不能为空").show();eval(mt+"flag=false")}else{eval(mt+"flag=true");$("#"+textJson.keyName).parent().next(".tip").text("").hide()}}})}function createPhoneNumber($parentCotroller,textJson){var mt=getKeyNameModeltype(textJson.keyName);if(textJson.notNull=="Y"){var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/xing8.png"><label>'+textJson.keyText+"</label>"}else{var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/null.png"><label>'+textJson.keyText+"</label>"}if(textJson.readOnly==0||textJson.readOnly==undefined){textHtml+='<input type="tel" placeholder="'+textJson.placeHolder+'" class="mui-input-clear" id="'+textJson.keyName+'" value="'+showValue(textJson.value)+'" onkeyup="idPhoneKeyup(this,\''+mt+"')\">"}else{if(textJson.readOnly==1){textHtml+='<input type="tel" placeholder="'+textJson.placeHolder+'" id="'+textJson.keyName+'" readonly="readonly" value="'+showValue(textJson.value)+'" onkeyup="idPhoneKeyup(this,\''+mt+"')\">"}}textHtml+='</div><div class="tip"></div>';$parentCotroller.append(textHtml);$("#"+textJson.keyName).blur(function(){var thisVal=$(this).val();if(thisVal==""&&textJson.notNull=="Y"){$("#"+textJson.keyName).parent().next(".tip").text(textJson.keyText+"不能为空").show();eval(mt+"flag=false")}else{if(!$.valid.isPhoneNumber(thisVal)){$("#"+textJson.keyName).parent().next(".tip").text(textJson.keyText+"不合法").show();eval(mt+"flag=false")}else{eval(mt+"flag=true");$("#"+textJson.keyName).parent().next(".tip").text("").hide()}}})}function createIdCard($parentCotroller,textJson){var mt=getKeyNameModeltype(textJson.keyName);if(textJson.notNull=="Y"){var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/xing8.png"><label>'+textJson.keyText+"</label>"}else{var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/null.png"><label>'+textJson.keyText+"</label>"
}if(textJson.readOnly==0||textJson.readOnly==undefined){textHtml+='<input type="text" placeholder="'+textJson.placeHolder+'" class="mui-input-clear1" id="'+textJson.keyName+'" value="'+showValue(textJson.value)+'"  onkeyup="idCardKeyup(this,\''+mt+"')\">"}else{if(textJson.readOnly==1){textHtml+='<input type="text" placeholder="'+textJson.placeHolder+'" id="'+textJson.keyName+'" readonly="readonly" value="'+showValue(textJson.value)+'"  onkeyup="idCardKeyup(this,\''+mt+"')\">"}}textHtml+='</div><div class="tip"></div>';$parentCotroller.append(textHtml)}function createEmail($parentCotroller,textJson){if(textJson.notNull=="Y"){var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/xing8.png"><label>'+textJson.keyText+"</label>"}else{var textHtml='<div class="mui-input-row"><img class="xing" src="../images/product/null.png"><label>'+textJson.keyText+"</label>"}if(textJson.readOnly==0||textJson.readOnly==undefined){textHtml+='<input type="text" placeholder="'+textJson.placeHolder+'" class="mui-input-clear" id="'+textJson.keyName+'" value="'+showValue(textJson.value)+'">'}else{if(textJson.readOnly==1){textHtml+='<input type="text" placeholder="'+textJson.placeHolder+'" id="'+textJson.keyName+'" readonly="readonly" value="'+showValue(textJson.value)+'">'}}textHtml+='</div><div class="tip"></div>';$parentCotroller.append(textHtml);emailAssit(textJson.keyName)}function createTextarea($parentCotroller,textareaJson){var textareaHtml='<div><ul class="mui-table-view">'+'<li class="mui-table-view-cell mui-collapse mui-collapse">'+'<a class="mui-navigate-right" href="#">'+textareaJson.keyText+"</a>"+'<div class="mui-collapse-content">'+'<p id="'+textareaJson.keyName+'">'+textareaJson.value+"</p>"+"</div></li></ul></div>";$parentCotroller.append(textareaHtml)}function createNumeric($parentCotroller,numericJson,dw){if(numericJson.notNull=="Y"){var numericHtml='<div class="mui-input-row"><img class="xing" src="../images/product/xing8.png"><label>'+numericJson.keyText+"</label>"}else{var numericHtml='<div class="mui-input-row"><img class="xing" src="../images/product/null.png"><label>'+numericJson.keyText+"</label>"}numericHtml+='<label class="dw">'+dw+"</label>";if(numericJson.readOnly==0||numericJson.readOnly==undefined){numericHtml+='<input type="text" value="'+numericJson.value+'" placeholder="'+numericJson.placeHolder+'" class="mui-input-clear" id="'+numericJson.keyName+'"  onkeyup="numericKeyup(this)">'}else{if(numericJson.readOnly==1){numericHtml+='<input type="text" value="'+numericJson.value+'" placeholder="'+numericJson.placeHolder+'" id="'+numericJson.keyName+'" readonly="readonly" onkeyup="numericKeyup(this)">'}}numericHtml+='</div><div class="tip"></div>';$parentCotroller.append(numericHtml);$("#"+numericJson.keyName).blur(function(){if($(this).val()==""&&numericJson.notNull=="Y"){$("#"+numericJson.keyName).parent().next(".tip").text(numericJson.keyText+"不能为空").show();var mt=getKeyNameModeltype(numericJson.keyName);eval(mt+"flag=false")}else{eval(mt+"flag=true");$("#"+numericJson.keyName).parent().next(".tip").text("").hide()}})}function createDate($parentCotroller,dateJson,option){var dateHtml='<div class="mui-input-row">';if(dateJson.notNull=="Y"){dateHtml+='<img class="xing" src="../images/product/xing8.png"><label>'+dateJson.keyText+"</label>"}else{dateHtml+='<img class="xing" src="../images/product/null.png"><label>'+dateJson.keyText+"</label>"}dateHtml+='<input style="width:6em" id="'+dateJson.keyName+'" class="dtPicker" placeholder="'+dateJson.placeHolder+'" readonly/>';dateHtml+='</div><div class="tip"></div>';$parentCotroller.append(dateHtml);var dateEvent=dateJson.event;if(dateJson.readOnly==0){$("#"+dateJson.keyName).before('<button class="addOneDayBtn"</button>');$("#"+dateJson.keyName).after('<button class="minusOneDayBtn"</button>');$(".addOneDayBtn").unbind("click");$(".minusOneDayBtn").unbind("click");$(".addOneDayBtn").click(function(){var a=$(this).siblings("input").val();if(a!=""){var r=Global.DateUtil.addNDays(a,1);r=Global.DateUtil.formatDate(r);$(this).siblings("input").val(r);var thisId=$(this).siblings("input").attr("id");var endDate=getKeyNameEvent(thisId);var b=$("#"+endDate).val();var c=Global.DateUtil.addNDays(b,1);c=Global.DateUtil.formatDate(c);$("#"+endDate).val(c)}});$(".minusOneDayBtn").click(function(){var a=$(this).siblings("input").val();if(a!=""){var r=Global.DateUtil.addNDays(a,-1);r=Global.DateUtil.formatDate(r);$(this).siblings("input").val(r);var thisId=$(this).siblings("input").attr("id");var endDate=getKeyNameEvent(thisId);var b=$("#"+endDate).val();var c=Global.DateUtil.addNDays(b,-1);c=Global.DateUtil.formatDate(c);$("#"+endDate).val(c)}})}var dtPicker=document.getElementById(dateJson.keyName);if(dateJson.event==""){mui("body").on("tap","#"+dateJson.keyName,function(){var myDate=new Date();var yyyy=myDate.getFullYear();var mm=myDate.getMonth();var dd=myDate.getDate();if(option==""||option==undefined){var picker=new mui.DtPicker({type:"date",startDate:new Date(yyyy,mm,dd),beginYear:1900})
}else{var picker=new mui.DtPicker(option)}picker.show(function(items){$("#"+dateJson.keyName).parent().next(".tip").text("").hide();dtPicker.value=items.value;picker.dispose()})},false)}}function createTime($parentCotroller,timeJson,option){var timeHtml='<div class="mui-input-row">';if(timeJson.notNull=="Y"){timeHtml+='<img class="xing" src="../images/product/xing8.png"><label>'+timeJson.keyText+"</label>"}else{timeHtml+='<img class="xing" src="../images/product/null.png"><label>'+timeJson.keyText+"</label>"}timeHtml+='<input placeholder="请选择时间" id="'+timeJson.keyName+'">';timeHtml+='</div><div class="tip"></div>';$parentCotroller.append(timeHtml);var startTime=document.getElementById(timeJson.keyName);mui("body").on("tap","#"+timeJson.keyName,function(){var picker=new mui.DtPicker({type:"time",});if(option==""||option==undefined){var picker=new mui.DtPicker({type:"time",})}else{var picker=new mui.DtPicker(option)}picker.show(function(rs){startTime.value=rs.text;picker.dispose()})});if(timeJson.value!=""){var valueStr=timeJson.value;var arr1=valueStr.split(",");var fnName=arr1[0];if(fnName.indexOf("@")==0){fnName=fnName.substr(1);var arr2=arr1.splice(1,arr1.length);var kk=eval(fnName+"(arr2[0]);");startTime.value=kk}}}function createRadio($parentCotroller,radioJson){if(radioJson.notNull=="Y"){var radioHtml='<div class="mui-input-row"><img class="xing" src="../images/product/xing8.png"><label>'+radioJson.keyText+"</label>"}else{var radioHtml='<div class="mui-input-row"><img class="xing" src="../images/product/null.png"><label>'+radioJson.keyText+"</label>"}var radioStr="";var name=radioJson.keyName;var value=radioJson.value;$.each(value,function(k,v){radioStr+='<div class="mui-radio mui-left">';radioStr+="<label>"+v.text+"</label>";if(v.checked){radioStr+='<input name="'+name+'" type="radio" checked value="'+v.value+'">'}else{radioStr+='<input name="'+name+'" type="radio" value="'+v.value+'">'}radioStr+="</div>"});radioHtml+=radioStr;radioHtml+="</div>";$parentCotroller.append(radioHtml)}function createSelect($parentCotroller,selectJson){var selectHtml='<div class="mui-input-row">';if(selectJson.notNull=="Y"){selectHtml+='<img class="xing" src="../images/product/xing8.png"><label>'+selectJson.keyText+"</label>"}else{selectHtml+='<img class="xing" src="../images/product/null.png"><label>'+selectJson.keyText+"</label>"}selectHtml+='<span class="select" value="" id="'+selectJson.keyName+'">请选择</span>';selectHtml+='</div><div class="tip"></div>';$parentCotroller.append(selectHtml);var selectDom=document.getElementById(selectJson.keyName);var selectPickerData=selectJson.value;if(selectJson.event==""){selectDom.addEventListener("tap",function(){var selectPicker=new mui.PopPicker();selectPicker.setData(selectPickerData);selectPicker.show(function(items){$("#"+selectJson.keyName).parent().next(".tip").text("").hide();selectDom.innerText=items[0].text;selectDom.setAttribute("value",items[0].value);selectPicker.dispose()})},false);for(var x in selectPickerData){if(selectPickerData[x].checked){$("#"+selectJson.keyName).html(selectPickerData[x].text);$("#"+selectJson.keyName).attr("value",selectPickerData[x].value)}}}}function validCurPage(validJson){var result=true;$.each(validJson,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.type!="select"&&v.type!="radio"&&v.notNull=="Y"){if($("#"+v.keyName).val()==""){mui.alert(v.keyText+"不能为空");result=false;return false}}})});return result}function createPage(productJson){$.each(productJson,function(k,v){switch(v.modelType){case"home":var xmlNode=v.xmlNode;if($("#page1Submit").length==0){var btnHtml='<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="page1Submit">确定</button>'+"</div>";$("#page1 .pt-triggers").append(btnHtml)}var section='<div class="mui-input-group section"></div>';$("#page1 .buttonBlock").before(section);var kk=k;$.each(v.modelColumn,function(k,v){var cpxxJson=v.groupColumn;var titleHtml;if(v.type=="label"){titleHtml='<div class="mui-input-row row-title expand">'+'<div class="row-title-text">'+v.groupName+"</div>";if(kk==0){if(isFavorited){titleHtml+='<div class="favorite" data-value="1" data-prdId="'+prdId+'"><img src="../images/favor-icon.png"></div>'}else{titleHtml+='<div class="favorite" data-value="0" data-prdId="'+prdId+'"><img src="../images/favor-icon3.png"></div>'}}titleHtml+="</div>"}else{if(v.type=="scan"){titleHtml='<div class="mui-input-row row-title expand">'+'<div class="row-title-text">'+v.groupName+"</div>"+'<img src="../images/scan.png" class="scanButton" alt="'+v.event+'">'+"</div>"}}$("#page1 .pt-triggers .section").eq(homeNum).append(titleHtml);$(".favorite").unbind("click");$(".favorite").click(function(){var _this=$(this);var isFavor=parseInt(_this.attr("data-value"));var prdId=_this.attr("data-prdId");GetData("favorite/set",function(res){console.log(res);if(isFavor){_this.attr("data-value",0);_this.children("img").attr("src","../images/favor-icon3.png")}else{_this.attr("data-value",1);
_this.children("img").attr("src","../images/favor-icon.png")}},{"prdId":prdId,"type":isFavor})});$.each(cpxxJson,function(k,v){switch(v.type){case"text":createText($("#page1 .pt-triggers .section").eq(homeNum),v);break;case"phoneNumber":createPhoneNumber($("#page1 .pt-triggers .section").eq(homeNum),v);break;case"idcard":createIdCard($("#page1 .pt-triggers .section").eq(homeNum),v);break;case"email":createEmail($("#page1 .pt-triggers .section").eq(homeNum),v);break;case"textarea":createTextarea($("#page1 .pt-triggers .section").eq(homeNum),v);break;case"numeric":createNumeric($("#page1 .pt-triggers .section").eq(homeNum),v,"元");break;case"date":if(xmlNode=="AGREEMENT"){var myDate=new Date();var yyyy=myDate.getFullYear();var mm=myDate.getMonth();var dd=myDate.getDate();createDate($("#page1 .pt-triggers .section").eq(homeNum),v,{type:"date",startDate:new Date(yyyy,mm,dd),beginYear:2016})}else{var myDate=new Date();var yyyy=myDate.getFullYear();var mm=myDate.getMonth();var dd=myDate.getDate();createDate($("#page1 .pt-triggers .section").eq(homeNum),v,{type:"date",startDate:new Date(yyyy,mm,dd),beginYear:1900})}break;case"time":createTime($("#page1 .pt-triggers .section").eq(homeNum),v);break;case"radio":createRadio($("#page1 .pt-triggers .section").eq(homeNum),v);break;case"select":createSelect($("#page1 .pt-triggers .section").eq(homeNum),v);break;default:break}})});homeNum++;$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.event!=""){if(v.type=="date"){var dtPicker=document.getElementById(v.keyName);if(v.value!=""){var valueStr=v.value;var arr1=valueStr.split(",");var fnName=arr1[0];if(fnName.indexOf("@")==0){fnName=fnName.substr(1);var arr2=arr1.splice(1,arr1.length);var kk=eval(fnName+"(arr2[0]);");dtPicker.value=kk;var resStr=changeValue(v.event,groupColumn);var endDate=document.getElementById(v.event);endDate.value=resStr}}mui("body").on("tap","#"+v.keyName,function(){var myDate=new Date();var yyyy=myDate.getFullYear();var mm=myDate.getMonth();var dd=myDate.getDate();var picker=new mui.DtPicker({type:"date",startDate:new Date(yyyy,mm,dd),});picker.show(function(items){$("#"+v.keyName).parent().next(".tip").text("").hide();dtPicker.value=items.value;var resStr=changeValue(v.event,groupColumn);var endDate=document.getElementById(v.event);endDate.value=resStr;picker.dispose()})},false)}}})});break;case"nextPage":pageNum++;var secListHtml;var showText=v.showText;if($(".secList").length==0){secListHtml='<div class="mui-input-group section secList">'+'<ul class="mui-table-view">'+'<li class="mui-table-view-cell">'+'<a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="nextPageTip" id="nextPageTip'+pageNum+'"></span></a>'+"</li></ul></div>";$("#page1 .buttonBlock").before(secListHtml)}else{$("#page1 .secList ul").append('<li class="mui-table-view-cell"><a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="nextPageTip" id="nextPageTip'+pageNum+'"></span></a></li>')}$("#pt-main").append('<div class="pt-page" id="page'+pageNum+'" last-page="page1"><div class="pt-triggers"><div class="row-group section info"></div></div></div>');if($("#page"+pageNum+"Submit").length==0){var btnHtml='<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="page'+pageNum+'Submit">确定</button>'+"</div>";$("#page"+pageNum+" .pt-triggers").append(btnHtml)}var $thisPage=$("#page"+pageNum);var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){if(v.type=="label"){var headHtml='<div class="title-row">'+'<img src="../images/product/baseinfo.png" class="title-row-icon">'+v.groupName+"</div>"}else{if(v.type=="scan"){var headHtml='<div class="title-row">'+'<img src="../images/product/businessman.png" class="title-row-icon">'+v.groupName+'<img src="../images/scan.png" class="scanButton" alt="'+v.event+'">'+"</div>"}}$thisPage.find(".section").append(headHtml);var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){switch(v.type){case"text":createText($thisPage.find(".section"),v);break;case"phoneNumber":createPhoneNumber($thisPage.find(".section"),v);break;case"idcard":createIdCard($thisPage.find(".section"),v);break;case"email":createEmail($thisPage.find(".section"),v);break;case"select":createSelect($thisPage.find(".section"),v);break;case"date":createDate($thisPage.find(".section"),v,{type:"date",beginYear:1900});break;case"radio":createRadio($thisPage.find(".section"),v);break;default:break}})});$("#page"+pageNum+"Submit").click(function(){var nextPageObj={};$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){getTextValue(nextPageObj,v.keyName,v.type)})});if($(".page"+pageNum+"HiddenInput").length==0){$("#page"+pageNum).append("<input type='text' value='"+JSON.stringify(nextPageObj)+"' class='page"+pageNum+"HiddenInput'>")}else{$(".page"+pageNum+"HiddenInput").val(JSON.stringify(nextPageObj))}var t=nextPageObj[showText];$("#nextPageTip"+pageNum).html(t);
if(validNull("nextPage")){changePage("page"+pageNum,"page1","last")}});$("#"+v.xmlNode).on("click",function(){if($(".page"+pageNum+"HiddenInput").length==0){$.each(productJson,function(k,v){var npm=1;if(v.modelType=="nextPage"){npm++;$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});$(".page"+npm+"HiddenInput").remove()}});changePage("page1","page"+pageNum,"next")}else{var tbrJson={};if($(".page"+pageNum+"HiddenInput").length==0){tbrJson=submitJson[editConfirmNo].APPLICANT;$(".page"+pageNum+"HiddenInput").val(JSON.stringify(tbrJson))}else{tbrJson=JSON.parse($(".page"+pageNum+"HiddenInput").val())}$.each(productJson,function(k,v){if(v.modelType=="nextPage"){$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){setTextValue(tbrJson,v.keyName,v.type)})})}});changePage("page1","page"+pageNum,"next")}});$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.event!=""){if(v.type=="select"){var selectDom=document.getElementById(v.keyName);var selectPickerData=v.value;selectDom.addEventListener("tap",function(){var selectPicker=new mui.PopPicker();selectPicker.setData(selectPickerData);selectPicker.show(function(items){$("#"+v.keyName).parent().next(".tip").text("").hide();selectDom.innerText=items[0].text;selectDom.setAttribute("value",items[0].value);if(selectDom.innerText=="本人"){var eventStr=v.event;var arr1=eventStr.split(",");var fnName=arr1[0];if(fnName.indexOf("@")==0){fnName=fnName.substr(1);var arr2=arr1.splice(1,arr1.length);eval(fnName+"(arr2);")}}selectPicker.dispose()})},false)}}})});break;case"confirm":var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;var type=v.type;if(type=="label"){var $conSec=$("#confirmPage .section").eq(0);var conTitleHtml='<div class="mui-input-row"><label class="green">'+v.groupName+"</label></div>";$conSec.append(conTitleHtml);$.each(groupColumn,function(k,v){var type=v.type;var conLiHtml="";if(type=="numeric"){conLiHtml='<div class="mui-input-row"><label>'+v.keyText+'</label><label class="dw">元</label><span id="'+v.keyName+'"></span></div>'}else{conLiHtml='<div class="mui-input-row"><label>'+v.keyText+'</label><span id="'+v.keyName+'">'+v.value+"</span></div>"}$conSec.append(conLiHtml)})}if(type=="list"){var confirmLiNo=$(".confirm-li").length+1;var confirmListLi='<div class="row-title">'+"<span>"+v.groupName+"</span>"+"</div>"+'<div class="confirm-li">'+'<label class="confirm-name">'+'<span id="conf_ISDNAME"></span>'+'</label><label class="confirm-sex">'+'<span id="conf_ISDNAME"></span>'+"</label></p>"+'<p style="font-size:17px;">证件号：<label class="confirm-idno">'+'<span id="conf_ISDIDNO"></span>'+"</label></p>"+"</div>";$("#confirmList").append(confirmListLi)}});break;case"listPage1":var secListHtml;if($(".secList").length==0){secListHtml='<div class="mui-input-group section secList">'+'<ul class="mui-table-view">'+'<li class="mui-table-view-cell">'+'<a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="listPageTip" id="listPageTip1"></span></a>'+"</li></ul></div>";$("#page1 .pt-triggers").before(secListHtml)}else{$("#page1 .secList ul").append('<li class="mui-table-view-cell"><a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="listPageTip" id="listPageTip1"></span></a></li>')}$("#pt-main").append('<div class="pt-page" id="listPage1" last-page="page1"><div class="pt-triggers"><div class="row-group section info"></div></div></div>');var cardPageHtml='<div class="pt-page" id="cardPage" last-page="page1">'+'<div class="pt-triggers">'+'<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="cardAddBtn">添加</button>'+'<button type="button" class="mui-btn mui-btn-block card-button" id="cardSaveBtn">保存</button>'+"</div></div></div>";$("#pt-main").append(cardPageHtml);if($("#listPage1Submit").length==0){var btnHtml='<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="listPage1Submit">保存</button>'+"</div>";$("#listPage1 .pt-triggers").append(btnHtml)}var $thisPage=$("#listPage1");var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){if(v.type=="label"){var headHtml='<div class="title-row">'+'<img src="../images/product/baseinfo.png" class="title-row-icon">'+v.groupName+"</div>"}else{if(v.type=="scan"){var headHtml='<div class="title-row">'+'<img src="../images/product/businessman.png" class="title-row-icon">'+v.groupName+'<img src="../images/scan.png" class="scanButton" alt="'+v.event+'">'+"</div>"}}$thisPage.find(".section").append(headHtml);var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){switch(v.type){case"text":createText($thisPage.find(".section"),v);break;case"phoneNumber":createPhoneNumber($thisPage.find(".section"),v);break;case"idcard":createIdCard($thisPage.find(".section"),v);break;case"email":createEmail($thisPage.find(".section"),v);
break;case"numeric":createNumeric($thisPage.find(".section"),v,"%");break;case"select":createSelect($thisPage.find(".section"),v);break;case"date":var myDate=new Date();var yyyy=myDate.getFullYear();var mm=myDate.getMonth();var dd=myDate.getDate();createDate($thisPage.find(".section"),v,{type:"date",startDate:new Date(yyyy,mm,dd),beginYear:1900});break;case"radio":createRadio($thisPage.find(".section"),v);break;default:break}})});$("#listPage1Submit").click(function(){listPage1flag=true;if(cardStatus=="add"){if(validNull("listPage1")&&validBNF()){changePage("listPage1","cardPage","last")}if(listPage1flag){var listPageObj={};$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){getTextValue(listPageObj,v.keyName,v.type)})});$("#listPage1").append("<input type='text' value='"+JSON.stringify(listPageObj)+"' class='listPage1HiddenInput'>");var cardHtml='<div class="row-group section cardinfo"><div class="card-row">'+'<label class="cardName">'+listPageObj.BNFNAME+"</label>"+'<label class="cardRelationship" value="'+listPageObj.BNFISDRLT+'">'+listPageObj.BNFISDRLT_TEXT+"</label>"+'<img src="../images/product/delete.png" class="deleteCardBtn">'+"</div>"+'<div class="card-row">'+'<span class="card-row-6">受益人序号：<label class="green cardXuhao" value="'+listPageObj.BNFORDER+'">'+listPageObj.BNFORDER_TEXT+"</label></span>"+'<span class="card-row-7">受益份额：<label class="green cardFene">'+listPageObj.BNFSHAREPCENT+'</label><label class="green">/100</label></span>'+"</div>"+'<div class="card-row">'+'证件号：<label class="cardIdno">'+listPageObj.BNFIDNO+"</label>"+"</div></div>";$("#cardPage .buttonBlock").before(cardHtml)}$(".cardinfo").off("click");$(".cardinfo").on("click",function(){var cardIndex=$(this).index();var cardJson=JSON.parse($(".listPage1HiddenInput").eq(cardIndex).val());$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){setTextValue(cardJson,v.keyName,v.type)})});cardStatus="edit";editCardNo=cardIndex;$("#cardPage").attr("last-page","page1");$("#listPage1").attr("last-page","cardPage");changePage("cardPage","listPage1","next");console.log(cardJson)});$(".deleteCardBtn").off("click");$(".deleteCardBtn").on("click",function(){var cardIndex=$(this).parents(".cardinfo").index();$(".cardinfo").eq(cardIndex).remove();$(".listPage1HiddenInput").eq(cardIndex).remove()})}else{if(cardStatus=="edit"){if(validNull("listPage1")&&validBNF()){changePage("listPage1","cardPage","last")}if(listPage1flag){var listPageObj={};$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){getTextValue(listPageObj,v.keyName,v.type)})});$(".listPage1HiddenInput").eq(editCardNo).val(JSON.stringify(listPageObj));$(".cardName").eq(editCardNo).html(listPageObj.BNFNAME);$(".cardRelationship").eq(editCardNo).html(listPageObj.BNFISDRLT_TEXT);$(".cardXuhao").eq(editCardNo).html(listPageObj.BNFORDER_TEXT);$(".cardFene").eq(editCardNo).html(listPageObj.BNFSHAREPCENT);$(".cardIdno").eq(editCardNo).html(listPageObj.BNFIDNO)}}}$("#cardAddBtn").unbind("click");$("#cardAddBtn").click(function(){$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});cardStatus="add";changePage("cardPage","listPage1","next")});$("#cardSaveBtn").unbind("click");$("#cardSaveBtn").click(function(){$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});var t=$("#cardPage").find(".section").length;if(validBNFSum()){$(".listPageTip").html(t);$(".cardinfo").remove();cardStatus="add";changePage("cardPage","page1","last")}})});$("#"+v.xmlNode).on("click",function(){if($(".listPage1HiddenInput").length==0){cardStatus="add";changePage("page1","listPage1","next")}else{$("#cardPage .buttonBlock").siblings(".cardinfo").remove();for(var i=0;i<$(".listPage1HiddenInput").length;i++){var listPageObj=JSON.parse($(".listPage1HiddenInput").eq(i).val());var cardHtml='<div class="row-group section cardinfo"><div class="card-row">'+'<label class="cardName">'+listPageObj.BNFNAME+"</label>"+'<label class="cardRelationship" value="'+listPageObj.BNFISDRLT+'">'+listPageObj.BNFISDRLT_TEXT+"</label>"+'<img src="../images/product/delete.png" class="deleteCardBtn">'+"</div>"+'<div class="card-row">'+'<span class="card-row-6">受益人序号：<label class="green cardXuhao" value="'+listPageObj.BNFORDER+'">'+listPageObj.BNFORDER_TEXT+"</label></span>"+'<span class="card-row-7">受益份额：<label class="green cardFene">'+listPageObj.BNFSHAREPCENT+'</label><label class="green">/100</label></span>'+"</div>"+'<div class="card-row">'+'证件号：<label class="cardIdno">'+listPageObj.BNFIDNO+"</label>"+"</div></div>";$("#cardPage .buttonBlock").before(cardHtml);$(".cardinfo").off("click");$(".cardinfo").on("click",function(){var cardIndex=$(this).index();var cardJson=JSON.parse($(".listPage1HiddenInput").eq(cardIndex).val());$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;
$.each(groupColumn,function(k,v){setTextValue(cardJson,v.keyName,v.type)})});cardStatus="edit";editCardNo=cardIndex;$("#cardPage").attr("last-page","page1");$("#listPage1").attr("last-page","cardPage");changePage("cardPage","listPage1","next");console.log(cardJson)});$(".deleteCardBtn").off("click");$(".deleteCardBtn").on("click",function(){var cardIndex=$(this).parents(".cardinfo").index();$(".cardinfo").eq(cardIndex).remove();$(".listPage1HiddenInput").eq(cardIndex).remove()})}changePage("page1","cardPage","next")}});$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.event!=""){if(v.type=="select"){var selectDom=document.getElementById(v.keyName);var selectPickerData=v.value;selectDom.addEventListener("tap",function(){var selectPicker=new mui.PopPicker();selectPicker.setData(selectPickerData);selectPicker.show(function(items){$("#"+v.keyName).parent().next(".tip").text("").hide();selectDom.innerText=items[0].text;selectDom.setAttribute("value",items[0].value);if(selectDom.innerText=="本人"){var eventStr=v.event;var arr1=eventStr.split(",");var fnName=arr1[0];if(fnName.indexOf("@")==0){fnName=fnName.substr(1);var arr2=arr1.splice(1,arr1.length);eval(fnName+"(arr2);")}}selectPicker.dispose()})},false)}}})});break;case"listPage2":var secListHtml;if($(".secList").length==0){secListHtml='<div class="mui-input-group section secList">'+'<ul class="mui-table-view">'+'<li class="mui-table-view-cell">'+'<a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="listPageTip" id="listPageTip2"></span></a>'+"</li></ul></div>";$("#page1 .buttonBlock").before(secListHtml)}else{$("#page1 .secList ul").append('<li class="mui-table-view-cell"><a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="listPageTip" id="listPageTip2"></span></a></li>')}$("#pt-main").append('<div class="pt-page" id="listPage2" last-page="page1"><div class="pt-triggers"><div class="row-group section info"></div></div></div>');var cardPageHtml='<div class="pt-page" id="cardPage2" last-page="page1">'+'<div class="pt-triggers">'+'<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="card2AddBtn">添加</button>'+'<button type="button" class="mui-btn mui-btn-block card-button" id="card2SaveBtn">保存</button>'+"</div></div></div>";$("#pt-main").append(cardPageHtml);if($("#listPage2Submit").length==0){var btnHtml='<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="listPage2Submit">保存</button>'+"</div>";$("#listPage2 .pt-triggers").append(btnHtml)}var $thisPage=$("#listPage2");var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){if(v.type=="label"){var headHtml='<div class="title-row">'+'<img src="../images/product/baseinfo.png" class="title-row-icon">'+v.groupName+"</div>"}else{if(v.type=="scan"){var headHtml='<div class="title-row">'+'<img src="../images/product/businessman.png" class="title-row-icon">'+v.groupName+'<img src="../images/scan.png" class="scanButton" alt="'+v.event+'">'+"</div>"}}$thisPage.find(".section").append(headHtml);var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){switch(v.type){case"text":createText($thisPage.find(".section"),v);break;case"phoneNumber":createPhoneNumber($thisPage.find(".section"),v);break;case"idcard":createIdCard($thisPage.find(".section"),v);break;case"email":createEmail($thisPage.find(".section"),v);break;case"numeric":createNumeric($thisPage.find(".section"),v,"%");break;case"select":createSelect($thisPage.find(".section"),v);break;case"date":var myDate=new Date();var yyyy=myDate.getFullYear();var mm=myDate.getMonth();var dd=myDate.getDate();createDate($thisPage.find(".section"),v,{type:"date",startDate:new Date(yyyy,mm,dd),beginYear:1900});break;case"radio":createRadio($thisPage.find(".section"),v);break;default:break}})});$("#listPage2Submit").click(function(){if(cardStatus2=="add"){if(validNull("listPage2")&&validPeopleSum()){changePage("listPage2","cardPage2","last")}if(listPage2flag){var listPageObj={};$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){getTextValue(listPageObj,v.keyName,v.type)})});$("#listPage2").append("<input type='text' value='"+JSON.stringify(listPageObj)+"' class='listPage2HiddenInput'>");var cardHtml='<div class="row-group section cardinfo2"><div class="card-row">'+'<label class="cardName2">'+listPageObj.ISDNAME_F+"</label>"+'<label class="cardRelationship2" value="'+listPageObj.APPRLT+'">'+listPageObj.APPRLT_TEXT+"</label>"+'<img src="../images/product/delete.png" class="deleteCardBtn">'+"</div>"+'<div class="card-row">'+'证件号：<label class="cardIdno2">'+listPageObj.ISDIDNO_F+"</label>"+"</div></div>";$("#cardPage2 .buttonBlock").before(cardHtml)}$(".cardinfo2").off("click");$(".cardinfo2").on("click",function(){var cardIndex=$(this).index();var cardJson=JSON.parse($(".listPage2HiddenInput").eq(cardIndex).val());$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;
$.each(groupColumn,function(k,v){setTextValue(cardJson,v.keyName,v.type)})});cardStatus2="edit";editCardNo2=cardIndex;$("#listPage2").attr("last-page","cardPage2");$("#cardPage2").attr("last-page","page1");changePage("cardPage2","listPage2","next");console.log(cardJson)});$(".deleteCardBtn").off("click");$(".deleteCardBtn").on("click",function(){var cardIndex=$(this).parents(".cardinfo2").index();$(".cardinfo2").eq(cardIndex).remove();$(".listPage2HiddenInput").eq(cardIndex).remove()})}else{if(cardStatus2=="edit"){if(validNull("listPage2")&&validPeopleSum()){changePage("listPage2","cardPage2","last")}if(listPage2flag){var listPageObj={};$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){getTextValue(listPageObj,v.keyName,v.type)})});$(".listPage2HiddenInput").eq(editCardNo).val(JSON.stringify(listPageObj));$(".cardName2").eq(editCardNo).html(listPageObj.APPNAME);$(".cardIdno2").eq(editCardNo).html(listPageObj.APPIDNO)}}}$("#card2AddBtn").unbind("click");$("#card2AddBtn").click(function(){$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});cardStatus2="add";changePage("cardPage2","listPage2","next")});$("#card2SaveBtn").unbind("click");$("#card2SaveBtn").click(function(){$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});var t=$("#cardPage2").find(".section").length;if(validPeopleSum()){$(".listPageTip2").html(t);$(".cardinfo2").remove();cardStatus2="add";changePage("cardPage2","page1","last")}})});$("#"+v.xmlNode).on("click",function(){if($(".listPage2HiddenInput").length==0){cardStatus2="add";changePage("page1","listPage2","next")}else{$("#cardPage2 .buttonBlock").siblings(".cardinfo2").remove();for(var i=0;i<$(".listPage2HiddenInput").length;i++){var listPageObj=JSON.parse($(".listPage2HiddenInput").eq(i).val());var cardHtml='<div class="row-group section cardinfo2"><div class="card-row">'+'<label class="cardName2">'+listPageObj.ISDNAME_F+"</label>"+'<label class="cardRelationship2" value="'+listPageObj.APPRLT+'">'+listPageObj.APPRLT_TEXT+"</label>"+'<img src="../images/product/delete.png" class="deleteCardBtn">'+"</div>"+'<div class="card-row">'+'证件号：<label class="cardIdno2">'+listPageObj.ISDIDNO_F+"</label>"+"</div></div>";$("#cardPage2 .buttonBlock").before(cardHtml);$(".cardinfo2").off("click");$(".cardinfo2").on("click",function(){var cardIndex=$(this).index();var cardJson=JSON.parse($(".listPage2HiddenInput").eq(cardIndex).val());$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){setTextValue(cardJson,v.keyName,v.type)})});cardStatus2="edit";editCardNo2=cardIndex;$("#listPage2").attr("last-page","cardPage2");$("#cardPage2").attr("last-page","page1");changePage("cardPage2","listPage2","next");console.log(cardJson)});$(".deleteCardBtn").off("click");$(".deleteCardBtn").on("click",function(){var cardIndex=$(this).parents(".cardinfo2").index();$(".cardinfo2").eq(cardIndex).remove();$(".listPage2HiddenInput").eq(cardIndex).remove()})}changePage("page1","cardPage2","next")}});$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.event!=""){if(v.type=="select"){var selectDom=document.getElementById(v.keyName);var selectPickerData=v.value;selectDom.addEventListener("tap",function(){var selectPicker=new mui.PopPicker();selectPicker.setData(selectPickerData);selectPicker.show(function(items){$("#"+v.keyName).parent().next(".tip").text("").hide();selectDom.innerText=items[0].text;selectDom.setAttribute("value",items[0].value);if(selectDom.innerText=="本人"){var eventStr=v.event;var arr1=eventStr.split(",");var fnName=arr1[0];if(fnName.indexOf("@")==0){fnName=fnName.substr(1);var arr2=arr1.splice(1,arr1.length);eval(fnName+"(arr2);")}}selectPicker.dispose()})},false)}}})});break;case"listPage3":var secListHtml;if($(".secList").length==0){secListHtml='<div class="mui-input-group section secList">'+'<ul class="mui-table-view">'+'<li class="mui-table-view-cell">'+'<a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="listPageTip" id="listPageTip3"></span></a>'+"</li></ul></div>";$("#page1 .buttonBlock").before(secListHtml)}else{$("#page1 .secList ul").append('<li class="mui-table-view-cell"><a class="mui-navigate-right" id="'+v.xmlNode+'">'+v.modelName+'<span class="listPageTip" id="listPageTip3"></span></a></li>')}$("#pt-main").append('<div class="pt-page" id="listPage3" last-page="page1"><div class="pt-triggers"><div class="row-group section info"></div></div></div>');var cardPageHtml='<div class="pt-page" id="cardPage3" last-page="page1">'+'<div class="pt-triggers">'+'<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="card3AddBtn">添加</button>'+'<button type="button" class="mui-btn mui-btn-block card-button" id="card3SaveBtn">保存</button>'+"</div></div></div>";
$("#pt-main").append(cardPageHtml);if($("#listPage3Submit").length==0){var btnHtml='<div class="buttonBlock">'+'<button type="button" class="mui-btn mui-btn-block card-button" id="listPage3Submit">保存</button>'+"</div>";$("#listPage3 .pt-triggers").append(btnHtml)}var $thisPage=$("#listPage3");var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){if(v.type=="label"){var headHtml='<div class="title-row">'+'<img src="../images/product/baseinfo.png" class="title-row-icon">'+v.groupName+"</div>"}else{if(v.type=="scan"){var headHtml='<div class="title-row">'+'<img src="../images/product/businessman.png" class="title-row-icon">'+v.groupName+'<img src="../images/scan.png" class="scanButton" alt="'+v.event+'">'+"</div>"}}$thisPage.find(".section").append(headHtml);var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){switch(v.type){case"text":createText($thisPage.find(".section"),v);break;case"phoneNumber":createPhoneNumber($thisPage.find(".section"),v);break;case"idcard":createIdCard($thisPage.find(".section"),v);break;case"email":createEmail($thisPage.find(".section"),v);break;case"numeric":createNumeric($thisPage.find(".section"),v,"%");break;case"select":createSelect($thisPage.find(".section"),v);break;case"date":var myDate=new Date();var yyyy=myDate.getFullYear();var mm=myDate.getMonth();var dd=myDate.getDate();createDate($thisPage.find(".section"),v,{type:"date",startDate:new Date(yyyy,mm,dd),beginYear:1900});break;case"radio":createRadio($thisPage.find(".section"),v);break;default:break}})});$("#listPage3Submit").click(function(){if(cardStatus3=="add"){if(validNull("listPage3")){changePage("listPage3","cardPage3","last")}if(listPage3flag){var listPageObj={};$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){getTextValue(listPageObj,v.keyName,v.type)})});$("#listPage3").append("<input type='text' value='"+JSON.stringify(listPageObj)+"' class='listPage3HiddenInput'>");var cardHtml='<div class="row-group section cardinfo3"><div class="card-row3">'+'<img src="../images/product/card-icon.png" class="card3-icon">'+'<label class="cardName3">'+listPageObj.ISDNAME+"</label>"+'<img src="../images/product/delete.png" class="deleteCardBtn" style="top:15px;right:10px;">'+"</div>"+'<div class="card-row" style="font-size:15px;padding-left:45px;">'+'证件号：<label class="cardIdno3">'+listPageObj.ISDIDNO+"</label>"+"</div></div>";$("#cardPage3 .buttonBlock").before(cardHtml)}$(".cardinfo3").off("click");$(".cardinfo3").on("click",function(){var cardIndex=$(this).index();var cardJson=JSON.parse($(".listPage3HiddenInput").eq(cardIndex).val());$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){setTextValue(cardJson,v.keyName,v.type)})});cardStatus3="edit";editCardNo3=cardIndex;$("#cardPage3").attr("last-page","page1");$("#listPage3").attr("last-page","cardPage3");changePage("cardPage3","listPage3","next");console.log(cardJson)});$(".deleteCardBtn").off("click");$(".deleteCardBtn").on("click",function(){var cardIndex=$(this).parents(".cardinfo3").index();$(".cardinfo3").eq(cardIndex).remove();$(".listPage3HiddenInput").eq(cardIndex).remove()})}else{if(cardStatus3=="edit"){if(validNull("listPage3")){changePage("listPage3","cardPage3","last")}if(listPage3flag){var listPageObj={};$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){getTextValue(listPageObj,v.keyName,v.type)})});$(".listPage3HiddenInput").eq(editCardNo).val(JSON.stringify(listPageObj));$(".cardName3").eq(editCardNo).html(listPageObj.BNFNAME);$(".cardIdno3").eq(editCardNo).html(listPageObj.BNFIDNO)}}}$("#card3AddBtn").unbind("click");$("#card3AddBtn").click(function(){$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});cardStatus3="add";changePage("cardPage3","listPage3","next")});$("#card3SaveBtn").unbind("click");$("#card3SaveBtn").click(function(){$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){clearTextValue(v.keyName,v.type,v.value)})});var t=$("#cardPage3").find(".section").length;$(".listPageTip3").html(t);$(".cardinfo3").remove();cardStatus3="add";changePage("cardPage3","page1","last")})});$("#"+v.xmlNode).on("click",function(){if($(".listPage3HiddenInput").length==0){cardStatus3="add";changePage("page1","listPage3","next")}else{$("#cardPage3 .buttonBlock").siblings(".cardinfo3").remove();for(var i=0;i<$(".listPage3HiddenInput").length;i++){var listPageObj=JSON.parse($(".listPage3HiddenInput").eq(i).val());var cardHtml='<div class="row-group section cardinfo3"><div class="card-row3">'+'<img src="../images/product/card-icon.png" class="card3-icon">'+'<label class="cardName3">'+listPageObj.ISDNAME+"</label>"+'<img src="../images/product/delete.png" class="deleteCardBtn" style="top:15px;right:10px;">'+"</div>"+'<div class="card-row" style="font-size:15px;padding-left:45px;">'+'证件号：<label class="cardIdno3">'+listPageObj.ISDIDNO+"</label>"+"</div></div>";
$("#cardPage3 .buttonBlock").before(cardHtml);$(".cardinfo3").off("click");$(".cardinfo3").on("click",function(){var cardIndex=$(this).index();var cardJson=JSON.parse($(".listPage3HiddenInput").eq(cardIndex).val());$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){setTextValue(cardJson,v.keyName,v.type)})});cardStatus3="edit";editCardNo3=cardIndex;$("#cardPage3").attr("last-page","page1");$("#listPage3").attr("last-page","cardPage3");changePage("cardPage3","listPage3","next");console.log(cardJson)});$(".deleteCardBtn").off("click");$(".deleteCardBtn").on("click",function(){var cardIndex=$(this).parents(".cardinfo3").index();$(".cardinfo3").eq(cardIndex).remove();$(".listPage3HiddenInput").eq(cardIndex).remove()})}changePage("page1","cardPage3","next")}});$.each(v.modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.event!=""){if(v.type=="select"){var selectDom=document.getElementById(v.keyName);var selectPickerData=v.value;selectDom.addEventListener("tap",function(){var selectPicker=new mui.PopPicker();selectPicker.setData(selectPickerData);selectPicker.show(function(items){selectDom.innerText=items[0].text;selectDom.setAttribute("value",items[0].value);if(selectDom.innerText=="本人"){var eventStr=v.event;var arr1=eventStr.split(",");var fnName=arr1[0];if(fnName.indexOf("@")==0){fnName=fnName.substr(1);var arr2=arr1.splice(1,arr1.length);eval(fnName+"(arr2);")}}selectPicker.dispose()})},false)}}})});break;default:break}})}function getSingleTextValue(selectId,type){var res="";if(type=="select"){res=$("#"+selectId).attr("value")}else{if(type=="radio"){res=$("input:radio[name="+selectId+"]:checked").val()}else{if(type=="textarea"){res=$("#"+selectId).text()}else{res=$("#"+selectId).val()}}}return res}var homeflag=true;var nextPageflag=true;var listPage1flag=true;var listPage2flag=true;var listPage3flag=true;function validNull(pageName){if(pageName=="home"){$.each(productJson,function(k,v){if(v.modelType=="home"){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.notNull=="Y"){var textValue=getSingleTextValue(v.keyName,v.type);if(textValue==""){console.log(v.keyText+"不能为空");$("#"+v.keyName).parent().next(".tip").text(v.keyText+"不能为空").show();homeflag=false}else{}}})})}});return homeflag}else{if(pageName=="nextPage"){$.each(productJson,function(k,v){if(v.modelType=="nextPage"){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.notNull=="Y"){var textValue=getSingleTextValue(v.keyName,v.type);if(textValue==""){console.log(v.keyText+"不能为空");$("#"+v.keyName).parent().next(".tip").text(v.keyText+"不能为空").show();nextPageflag=false}else{}}})})}});return nextPageflag}else{if(pageName=="listPage1"){$.each(productJson,function(k,v){if(v.modelType=="listPage1"){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.notNull=="Y"){var textValue=getSingleTextValue(v.keyName,v.type);if(textValue==""){console.log(v.keyText+"不能为空");$("#"+v.keyName).parent().next(".tip").text(v.keyText+"不能为空").show();listPage1flag=false}else{}}})})}});return listPage1flag}else{if(pageName=="listPage2"){$.each(productJson,function(k,v){if(v.modelType=="listPage2"){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.notNull=="Y"){var textValue=getSingleTextValue(v.keyName,v.type);if(textValue==""){console.log(v.keyText+"不能为空");$("#"+v.keyName).parent().next(".tip").text(v.keyText+"不能为空").show();listPage2flag=false}else{}}})})}});return listPage2flag}else{if(pageName=="listPage3"){$.each(productJson,function(k,v){if(v.modelType=="listPage3"){var modelColumn=v.modelColumn;$.each(modelColumn,function(k,v){var groupColumn=v.groupColumn;$.each(groupColumn,function(k,v){if(v.notNull=="Y"){var textValue=getSingleTextValue(v.keyName,v.type);if(textValue==""){console.log(v.keyText+"不能为空");$("#"+v.keyName).parent().next(".tip").text(v.keyText+"不能为空").show();listPage3flag=false}else{}}})})}});return listPage3flag}}}}}}function validBNF(){var bnfFlag=true;var $bnf=$("#BNFSHAREPCENT");var bnfLen=$bnf.length;if(bnfLen>0){if(parseInt($bnf.val())>100){$bnf.parent().next(".tip").text("受益份额不能超过100").show();bnfFlag=false}}return bnfFlag}function validBNFSum(){var listPage1Len=$("#listPage1").length;if(listPage1Len==0){return true}else{var listPage1HiddenInput=$(".listPage1HiddenInput");if(listPage1HiddenInput.length==0){return true}else{var sum=0;$.each(listPage1HiddenInput,function(k,v){var valJson=JSON.parse(v.value);var fene=parseInt(valJson.BNFSHAREPCENT);sum=sum+fene});if(sum!=100){mui.alert("受益人份额之和应该为100");return false}else{return true}}}}function validPeopleSum(){var cardinfo2Len=$(".cardinfo2").length;if(cardinfo2Len>4){mui.alert("最多为4个福被保人");return false}else{return true
}};